<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>常见的视频传输协议：RTSP/RTMP/HLS | YuChou</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="RTSP协议1.概念 RTSP是一个基于文本的多媒体播放控制协议，属于应用层。 对应的协议标准是RFC2326 主要用来控制具有实时特性的数据的发送，但是其本身并不用于传送流媒体数据，而必须依赖下层传输协议(RTCP/RTP)所提供的服务来完成流媒体数据的发送。关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议  2.作用 控制信息 操作方法 状态码 描述与RTP之间的交互操作 流程">
<meta name="keywords" content="视频协议">
<meta property="og:type" content="article">
<meta property="og:title" content="常见的视频传输协议：RTSP&#x2F;RTMP&#x2F;HLS">
<meta property="og:url" content="http://yoursite.com/2019/03/22/常见的视频传输协议：RTSP-RTMP-HLS/index.html">
<meta property="og:site_name" content="YuChou">
<meta property="og:description" content="RTSP协议1.概念 RTSP是一个基于文本的多媒体播放控制协议，属于应用层。 对应的协议标准是RFC2326 主要用来控制具有实时特性的数据的发送，但是其本身并不用于传送流媒体数据，而必须依赖下层传输协议(RTCP/RTP)所提供的服务来完成流媒体数据的发送。关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议  2.作用 控制信息 操作方法 状态码 描述与RTP之间的交互操作 流程">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-03-22T14:27:56.823Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="常见的视频传输协议：RTSP&#x2F;RTMP&#x2F;HLS">
<meta name="twitter:description" content="RTSP协议1.概念 RTSP是一个基于文本的多媒体播放控制协议，属于应用层。 对应的协议标准是RFC2326 主要用来控制具有实时特性的数据的发送，但是其本身并不用于传送流媒体数据，而必须依赖下层传输协议(RTCP/RTP)所提供的服务来完成流媒体数据的发送。关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议  2.作用 控制信息 操作方法 状态码 描述与RTP之间的交互操作 流程">
  
    <link rel="alternate" href="/atom.xml" title="YuChou" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="http://149.248.3.74/Photos/titleImage/AF359E06C1819F0FA30D32DA9F0E8EB6.png">
    <h2 class="author">YuChou</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>9</strong><br>文章</div></a>
      <a href="/categories"><div><strong>7</strong><br>分类</div></a>
      <a href="/tags"><div><strong>10</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives/" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories/" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags/" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-常见的视频传输协议：RTSP-RTMP-HLS" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/22/常见的视频传输协议：RTSP-RTMP-HLS/" class="article-date">
  <time class="post-time" datetime="2019-03-22T14:26:49.000Z" itemprop="datePublished">
    <span class="post-month">3月</span><br/>
    <span class="post-day">22</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      常见的视频传输协议：RTSP/RTMP/HLS
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/协议/">协议</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="RTSP协议"><a href="#RTSP协议" class="headerlink" title="RTSP协议"></a>RTSP协议</h3><h4 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h4><ul>
<li>RTSP是一个基于文本的多媒体播放控制协议，属于应用层。</li>
<li>对应的协议标准是RFC2326</li>
<li>主要用来控制具有实时特性的数据的发送，但是其本身并不用于传送流媒体数据，而必须依赖下层传输协议(RTCP/RTP)所提供的服务来完成流媒体数据的发送。<h5 id="关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议"><a href="#关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议" class="headerlink" title="关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议"></a>关键词：基于文本、应用层、RFC2326、实时、依赖下层传输协议</h5></li>
</ul>
<h4 id="2-作用"><a href="#2-作用" class="headerlink" title="2.作用"></a>2.作用</h4><ul>
<li>控制信息</li>
<li>操作方法</li>
<li>状态码</li>
<li>描述与RTP之间的交互操作</li>
<li>流程：internet–&gt;IP–&gt;(UDP/TCP)–(RTP/RTCP/RTSP)–&gt;Video/Audio</li>
</ul>
<h4 id="3-交互过程"><a href="#3-交互过程" class="headerlink" title="3.交互过程"></a>3.交互过程</h4><pre><code>+ C-&gt;S(OPTION request):Client询问Server有哪些方法可用
+ S-&gt;C(OPTION response):Server回应信息中包含的所有方法
+ C-&gt;S(DESCRIBE request):Client请求得到Server提供的媒体初始化描述信息
+ S-&gt;C(DESCRIBE response):Server回应媒体初始化信息主要是SDP(会话描述协议)
+ C-&gt;S(SETUP request):设置会话属性及传输模式，建立会话
+ S-&gt;C(SETUP response):Server建立会话，返回会话标识符以及会话相关信息
+ C-&gt;S(PLAY request):Client请求播放
+ S-&gt;(PLAY response):Server回应播放请求信息
+ S-&gt;C(Media Data Transfer):发送流媒体数据
+ C-&gt;S(TEARDOWN request):Client请求关闭会话
+ S-&gt;C(TEARDOWN response):Server回应关闭请求会话
</code></pre><h4 id="4-RTSP报文"><a href="#4-RTSP报文" class="headerlink" title="4.RTSP报文"></a>4.RTSP报文</h4><ul>
<li>OPTIONS请求：客户端向服务器询问可用的方法</li>
<li>DESCRIBE请求：客户端向服务器请求媒体资源描述，服务器端通过SDP(Session Description Protocol)格式回应客户端的请求。资源描述中会列出所请求媒体的媒体流及其相关信息</li>
<li>SETUP请求：确定了具体的媒体流如何传输，该请求必须在PLAY请求之前发送。SETUP请求包含媒体流的URL和客户端用于接收RTP数据(audio or video)的端口以及接收RTCP数据(meta information)的端口。服务器端的回复通常包含客户端请求参数的确认，并会补充缺失的部分，比如服务器选择的发送端口</li>
<li>PLAY请求：播放一个或全部媒体流，PLAY请求中可指定播放的range，若未指定，则从媒体流的开始播放到结束</li>
<li>PAUSE请求：暂停一个或所有媒体流，后续可通过PLAY请求恢复播放。若参数range存在，则指明在何处暂停，若该参数不存在，则暂停立即生效</li>
<li>TEARDOWN请求：结束会话</li>
<li>GET_PARAMETER / SET_PARAMETER请求: 检索/设置媒体流的参数值，不携带消息体的GET_PARAMETER可用来测试服务器端或客户端是否可通(类似ping的功能)。<h4 id="5-RTSP认证"><a href="#5-RTSP认证" class="headerlink" title="5.RTSP认证"></a>5.RTSP认证</h4></li>
<li>RTSP认证主要分两种：基本认证（basic authentication）和摘要认证（digest authentication）</li>
<li>基本认证是http 1.0提出的认证方案，其消息传输不经过加密转换因此存在严重的安全隐患（base64编码）</li>
<li>摘要认证是http 1.1提出的基本认证的替代方案，其消息经过MD5哈希转换因此具有更高的安全性。<h4 id="6-RTSP基本认证"><a href="#6-RTSP基本认证" class="headerlink" title="6.RTSP基本认证"></a>6.RTSP基本认证</h4></li>
<li>客户端发送DESCRIBE请求到服务端，RTSP服务端认为没有通过认证，发出WWW-Authenticate认证响应</li>
<li>客户端携带Authorization串再次发出DESCRIBE请求<h4 id="7-RTSP摘要认证"><a href="#7-RTSP摘要认证" class="headerlink" title="7.RTSP摘要认证"></a>7.RTSP摘要认证</h4></li>
<li>客户端发送DESCRIBE请求，服务器端返回401错误，提示未认证并以nonce质询</li>
<li>客户端以用户名，密码，nonce，HTTP方法，请求的URI等信息为基础产生response信息进行反馈</li>
<li>服务器对客户端反馈的response进行校验</li>
</ul>
<h3 id="RTMP协议"><a href="#RTMP协议" class="headerlink" title="RTMP协议"></a>RTMP协议</h3><ul>
<li>RTMP协议是Real Time Message Protocol(实时信息传输协议)的缩写，它是由Adobe公司提出的一种应用层的协议</li>
<li>RTMP一般采用TCP作为传输层，在基于传输层协议的链接建立完成后，RTMP协议也要客户端和服务器通过“握手”来建立基于传输层链接之上的RTMP Connection链接</li>
<li>RTMP协议中基本的数据单元称为消息。消息被拆分成更小的消息块进行传输，接收端再进行组合并解封装后得到媒体数据</li>
<li>速度快，误码率低，延迟低RTMP 是专为流媒体服务而生，协议在制定的时候就考虑到很多底层的优化消息块的传输能够提供更加稳定的直播环境</li>
<li>RTMP视频的封装格式是基于flv，支持flash播放，低延时，常常用于互联网直播应用，但在HTML5中需要使用插件才能支持，一般不支持IOS设备<h3 id="HLS协议"><a href="#HLS协议" class="headerlink" title="HLS协议"></a>HLS协议</h3><h4 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h4></li>
<li>HTTP Live Streaming，是Apple的开放标准，基于HTTP流，它最初是苹果公司针对iPhone、iPod、iTouch和iPad等移动设备而开发的流，现在见到在桌面也有很多应用了，由于是基于HTTP的，因此很多HTTP的优点都得到了继承。<h4 id="2-特点"><a href="#2-特点" class="headerlink" title="2.特点"></a>2.特点</h4></li>
<li>将流媒体切分为若干 TS 片段（比如每10秒一段），然后通过一个扩展的 m3u 列表文件将这些 TS 片段集中起来供客户端播放器接收。<h4 id="3-流程功能块"><a href="#3-流程功能块" class="headerlink" title="3.流程功能块"></a>3.流程功能块</h4></li>
<li>视频输入或者采集设备给Media encoder</li>
<li>Media encoder：负责将视频源转码成H264的视频数据给stream segmenter模块</li>
<li>stream segmenter：模块将视频切片，得到index file（m3u8）和ts文件给Distribution</li>
<li>Distribution：一个普通的HTTP文件服务器传输给使用 者client</li>
<li>client<h4 id="4-视频文件索引-m3u8文件-？"><a href="#4-视频文件索引-m3u8文件-？" class="headerlink" title="4.视频文件索引(.m3u8文件)？"></a>4.视频文件索引(.m3u8文件)？</h4></li>
<li>#EXTM3U：每个m3u文件第一行必须是这个tag</li>
<li>#EXT-X-TARGETDURATION：指定最大的媒体段时间长（秒）</li>
<li>#EXT-X-MEDIA-SEQUENCE：第一个媒体段的序列号，默认为0</li>
<li>#EXTINF：指出媒体段的时间长度，紧接着指定媒体段的URL</li>
<li>#EXT-X-ENDLIST：媒体列表结束<h4 id="5-优缺点"><a href="#5-优缺点" class="headerlink" title="5.优缺点"></a>5.优缺点</h4></li>
<li>HLS协议一旦切分TS片段完成，之后的分发过程完全不需要额外使用任何专门软件，普通的网络服务器即可，大大降低了 CDN 边缘服务器的配置要求。</li>
<li>分发使用的协议是最常见 HTTP，代理服务器对这个协议的缓存优化相当成熟，而很少有代理服务器对 RTSP 的进行缓存优化。这对播放（软）实时视频有相当大的优势，因为这样分发后，对源服务器的负载压力小得多。</li>
<li>HLS支持自适应码率流播（adaptive streaming）。效果就是客户端会根据网络状况自动选择不同码率的视频流，并且自动在二者间随意切换。实现方法是服务器端提供多码率视频流，并且在列表文件中注明</li>
<li>HLS协议用 TS 而不是 MP4，因为两个 TS 片段可以无缝拼接，播放器能连续播放，而 MP4 文件由于编码方式的原因，两段 MP4 不能无缝拼接</li>
<li>IOS、Android、HTML5原生支持。</li>
<li>缺点：直播应用中，相比于RTMP延时长，基本在10秒以上。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/22/常见的视频传输协议：RTSP-RTMP-HLS/" data-id="cjtmcotnl0008yshzspa5c3ns" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/视频协议/">视频协议</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/03/24/unittest框架配置使用/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          unittest框架配置使用
        
      </div>
    </a>
  
  
    <a href="/2019/03/18/robotframework学习/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">robotframework初窥</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">YuChou</h1>
    <h2 class="blog-subtitle">Dream of walking the world with techbology</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives/" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories/" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags/" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="http://149.248.3.74/Photos/titleImage/AF359E06C1819F0FA30D32DA9F0E8EB6.png">
    <h2 class="author">YuChou</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>9</strong><br>文章</div></a>
      <a href="/categories"><div><strong>7</strong><br>分类</div></a>
      <a href="/tags"><div><strong>10</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="https://github.com/mrzhouyu" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>SomeLink</h2>
      
        <a class="hvr-bounce-in" href="https://www.zhihu.com" target="_blank" title="Zhihu">
          Zhihu
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2018 - 2019 YuChou<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title="" class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title="" class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>